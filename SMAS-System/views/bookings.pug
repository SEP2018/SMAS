extends layout

block content
    header(class='header')
        div(class='top-header-bg')
            a(href='/')
                img(src='/img/logo.png' class='logo')
            div(class='header-user')
                div(class='username')
                    p Chloe Dizon
                    // above is placeholder
                img(src='/img/logoutbtn.png' class='logout-btn')
                // above needs link + logout
        div(class='nav-menu-bg')
            div(class='nav-menu-container')
                ul.nav-menu
                    li
                        a(href='/doctors') Doctors
                    li
                        a(href='/services') Services
                    li
                        a(href='/appointments/bookings') Bookings
                    li
                        a(href='/') Home

    div(class='banner-area')
        img(src='/img/bookings-banner.jpg' class='banner')
        div(class='banner-heading-position')
            h1(class='banner-heading') Manage Bookings

    div(class='book-appointment-box')
        hbox(class='info-side')
            h2 Hi, User!
            p Book an appointment on the right, or manage your existing appointments below.

    div(class='existing-appointments-box')
        h2 Existing Appointments
        table(id='existingAppointments')

    footer(class='footer')
        div(class='footer-bg')
            div(class='footer-content')
                img(src='/img/footer-logo.png' class='footer-logo')
                div(class='footer-contact')
                    p(class='footer-text') For any questions or enquiries, please contact 0412 345 678 | utsmedical@uts.edu.au
                div(class='footer-links')
                    ul.nav-menu
                        li
                            a(href='/doctors') Doctors
                        li
                            a(href='/services') Services
                        li
                            a(href='/appointments/bookings') Bookings
                        li
                            a(href='/') Home

    script.
        $(document).ready(function() {
            populateTable();
        });

        function populateTable() {
            var id = '12876797';
            $.ajax({
                type: 'POST',
                data: {id: id},
                url: 'bookings/' + id,
                dataType: 'json',
                success: function(json) {
                    var $el = $('#existingAppointments');
                    $el.empty();
                    $el.append($('<tr>').append(
                        $('<th>').text('Service'),
                        $('<th>').text('Doctor'),
                        $('<th>').text('Date'),
                        $('<th>').text('Time'),
                        $('<th>').text('Duration')
                    ));
                    $.each(json, function() {
                        $el.append($('<tr id="' + this['appointmentID'] +'">').append(
                            $('<td id="title">').attr('value', this['serviceID']).text(this['serviceTitle']),
                            $('<td id="name">').attr('value', this['staffID']).text(this['staffName']),
                            $('<td id="date">').text(getDateFormat(this['appointmentDate'])),
                            $('<td id="time">').text(getTimeFormat(this['startTime'])),
                            $('<td id="duration">').text(this['duration'] + ' minutes'),
                            $('<td id="editButton">').append(
                                $('<button id="edit" onclick="editAppointment(this);">').text('Edit')
                            ),
                            $('<td id="deleteButton">').append(
                                $('<button id="delete" onclick="deleteAppointment(this);">').text('Delete')
                            )
                        ));
                    });
                }
            });
        };

        function deleteAppointment(button) {
            var row = button.parentNode.parentNode;
            $.ajax({
                type: 'POST',
                data: {id: row.id},
                url: 'delete',
                dataType: 'json',
                success: function() {
                    row.parentNode.removeChild(row);
                }
            });
        };

        function editAppointment(button) {
            var row = button.parentNode.parentNode;
            button.parentNode.innerHTML = '<button id="confirm" onclick="confirmAppointment(this);">Confirm</button>';
            row.childNodes[2].innerHTML = '<input id="date_dropdown" placeholder="Date" onfocus="(this.type=\'date\')">';
            row.childNodes[3].innerHTML = '<select id="time_dropdown" placeholder="Time" disabled></select>';
        };

        // $(document).on('change', '#date_dropdown', function(e){
        //     var doctor = $(this.parentNode.childNodes[1]).val();
        //     var service = $(this.parentNode.childNodes[0]).val();
        //     var date = $(this).val();
        //     var time_dropdown = this.parentNode.childNodes[3];
        //     $.ajax({
        //         type: "POST",
        //         data: {doctor: doctor, service: service, date: date},
        //         url: 'times/' + doctor,
        //         dataType: 'json',
        //         success: function (json) {
        //             console.log('success');
        //             var $el = $(time_dropdown);
        //             $el.empty();
        //             $el.removeAttr('disabled');
        //             $.each(json, function () {
        //                 $el.append($("<option></option>")
        //                     .attr("value", this['startTime']).text(this['startTime']));
        //             });
        //         }
        //     });
        // });

        function confirmAppointment(button) {

        };

        function getDateFormat(date) {
            var $date = new Date(date);
            var day = "";
            switch($date.getDay()) {
                case 0:
                    day = "Sunday";
                    break;
                case 1:
                    day = "Monday";
                    break;
                case 2:
                    day = "Tuesday";
                    break;
                case 3:
                    day = "Wednesday";
                    break;
                case 4:
                    day = "Thursday";
                    break;
                case 5:
                    day = "Friday";
                    break;
                case 6:
                    day = "Saturday";
                    break;
            }
            var dateNumber = $date.getDate();
            var month = "";
            switch ($date.getMonth()) {
                case 0:
                    month = "January";
                    break;
                case 1:
                    month = "February";
                    break;
                case 2:
                    month = "March";
                    break;
                case 3:
                    month = "April";
                    break;
                case 4:
                    month = "May";
                    break;
                case 5:
                    month = "June";
                    break;
                case 6:
                    month = "July";
                    break;
                case 7:
                    month = "August";
                    break;
                case 8:
                    month = "September";
                    break;
                case 9:
                    month = "October";
                    break;
                case 10:
                    month = "November";
                    break;
                case 11:
                    month = "December";
                    break;
            }
            return day + ', ' + dateNumber + ' ' + month;
        };

        function getTimeFormat(date) {
            var $date = new Date(date);
            var newDate = $date.toLocaleTimeString(undefined, {
                hour: '2-digit',
                minute: '2-digit'
            });
            return newDate;
        };